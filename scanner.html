<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–°–∫–∞–Ω–µ—Ä —à—Ç—Ä–∏—Ö–∫–æ–¥–æ–≤</title>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
            background-color: #f3f3f3;
        }
        #reader {
            width: 100%;
            max-width: 400px;
            margin: auto;
        }
        #result {
            margin-top: 20px;
            font-size: 1.2em;
            color: #333;
        }
        button {
            margin-top: 10px;
            padding: 10px 15px;
            font-size: 1em;
        }
    </style>
</head>
<body>
    <h2>üì∑ –°–∫–∞–Ω–∏—Ä—É–π—Ç–µ —à—Ç—Ä–∏—Ö–∫–æ–¥</h2>
    <div id="reader"></div>
    <div id="result"></div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const telegramUserId = urlParams.get("uid") || "unknown";

        function sendResultToTelegramBot(result) {
            if (window.Telegram && Telegram.WebApp) {
                Telegram.WebApp.sendData(result); // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–¥–∞ –æ–±—Ä–∞—Ç–Ω–æ –≤ Telegram-–±–æ—Ç
            } else {
                alert("Telegram WebApp API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.");
            }
        }

        function onScanSuccess(decodedText, decodedResult) {
            document.getElementById('result').innerText = `‚úÖ –ö–æ–¥: ${decodedText}`;
            html5QrcodeScanner.clear().then(() => {
                sendResultToTelegramBot(decodedText);
            }).catch(err => {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ —Å–∫–∞–Ω–µ—Ä–∞", err);
            });
        }

        const html5QrcodeScanner = new Html5Qrcode("reader");
        const config = { fps: 10, qrbox: 250 };

        html5QrcodeScanner.start(
            { facingMode: "environment" },
            config,
            onScanSuccess
        ).catch(err => {
            document.getElementById('result').innerText = `–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –∫–∞–º–µ—Ä—ã: ${err}`;
        });
    </script>
</body>
</html>
